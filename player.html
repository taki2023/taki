<style>
*{box-sizing:border-box}
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:transparent!important;
  overflow:hidden;
}

/* PLAYER */
#playerBox{
  width:100%;
  padding:10px 12px;
  background:linear-gradient(180deg,rgba(18,12,10,.92),rgba(10,8,7,.95));
  border:2.5px solid rgba(255,176,120,.55);
  border-radius:16px;
  box-shadow:inset 0 0 14px rgba(0,0,0,.55),0 0 14px rgba(255,176,120,.22);
}

/* BARS */
#progressBar,#volumeBar{
  background:linear-gradient(180deg,#1a120f,#120a08);
  border-radius:10px;
  border:1.8px solid rgba(255,176,120,.45);
  box-shadow:inset 0 0 8px rgba(0,0,0,.6),0 0 8px rgba(255,176,120,.15);
  position:relative;
  cursor:pointer;
}

/* FILLS */
#progressFilled{
  height:100%;
  background:linear-gradient(90deg,#ffb37a,#ff8a70);
  border-radius:10px;
}

#volumeFill{
  height:100%;
  background:linear-gradient(90deg,#7b4dff,#9d6bff,#c59bff);
  border-radius:10px;
}

/* KNOBS */
#progressKnob,#volumeKnob{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:14px;
  height:14px;
  border-radius:50%;
  background:#ffd7b0;
}

#volumeKnob{
  background:#e9ddff;
}

/* TOOLTIP */
.tooltip{
  position:fixed;
  background:#fff;
  color:#111;
  padding:2px 6px;
  border-radius:5px;
  font-size:11px;
  font-family:Segoe UI,sans-serif;
  box-shadow:0 2px 4px rgba(0,0,0,.25);
  pointer-events:none;
  opacity:0;
  transition:opacity .15s;
  z-index:9999;
  white-space:nowrap;
}

/* PLAYLIST */
#playlistContainer{
  margin-top:8px;
  max-height:140px;
  overflow-y:auto;
  padding-right:4px;
}

.playlistItem{
  cursor:pointer;
  padding:4px 8px;
  border-radius:6px;
  margin-bottom:2px;
  font-size:12px;
  font-family:Segoe UI,sans-serif;
  color:#f1e7df;
  background:rgba(255,176,120,0.05);
  transition:background .15s;
  user-select:none;

  /* NEW (layout for number + title + time) */
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
}

.playlistItem:hover{
  background:rgba(255,176,120,0.15);
}
.playlistItem.active{
  background:rgba(255,176,120,0.3);
}
.dragging{
  opacity:0.5;
  background:rgba(255,176,120,0.2);
}

.trackTime{
  font-size:11px;
  opacity:.7;
  white-space:nowrap;
}
</style>

<div id="playerBox">
  <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;width:100%;justify-content:center;">
    <button id="prevBtn" style="width:32px;height:32px;border-radius:50%; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); cursor:pointer;">‚èÆ</button>
    <button id="playPauseBtn" style="width:32px;height:32px;border-radius:50%; background:linear-gradient(145deg,#ffb37a,#ff8a70); border:none;cursor:pointer;">‚ñ∂</button>
    <button id="nextBtn" style="width:32px;height:32px;border-radius:50%; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); cursor:pointer;">‚è≠</button>

    <div id="progressBar" style="flex:1;height:8px;margin-left:12px;margin-right:12px;">
      <div id="progressFilled" style="width:0%;position:relative;">
        <div id="progressKnob" style="right:-7px;"></div>
      </div>
    </div>

    <div id="timeDisplay" style="min-width:60px;font-size:11px;color:#f1e7df;text-align:right;">0:00 / 0:00</div>
  </div>

  <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px;">
    <span id="cutIcon" style="cursor:pointer">üîä</span>
    <div id="volumeBar" style="width:90px;height:5px;">
      <div id="volumeFill"></div>
      <div id="volumeKnob"></div>
    </div>
    <button id="loopBtn" style="width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);color:#fff;">üîÅ</button>
  </div>

  <div id="playlistContainer"></div>
  <div id="tooltip" class="tooltip"></div>
  <audio id="audioPlayer"></audio>
</div>

<script>
const audio = document.getElementById('audioPlayer');
const playBtn = document.getElementById('playPauseBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const loopBtn = document.getElementById('loopBtn');
const cutIcon = document.getElementById('cutIcon');
const progressBar = document.getElementById('progressBar');
const progressFilled = document.getElementById('progressFilled');
const volumeBar = document.getElementById('volumeBar');
const volumeFill = document.getElementById('volumeFill');
const volumeKnob = document.getElementById('volumeKnob');
const timeDisplay = document.getElementById('timeDisplay');
const tooltip = document.getElementById('tooltip');
const playlistContainer = document.getElementById('playlistContainer');

/* ===== PLAYLIST WITH LOCAL STORAGE ===== */
let playlist = JSON.parse(localStorage.getItem('musicPlaylist')) || [
  { title:"Faded - Alan Walker", src:"https://cs1.mp3.pm/download/196179361/M0wyQ0lNU3lsSmcrcWVXSFZhSTFtTmZPTm9GL1VtLzMwNXNaZkpWU1FsTGdEcTNxcVFxVjd0dE1uM0dDdkx6Y0lxWk5tRDZqME5uR0NZa1NKeURsdTJZOTB1RVY3bFJlRWJ3UysyMXIvd0pvT21IY2doQ3UycWppcC9hYnc1Uzc/8D_TOP_MUSIC_-_Alan_Walker_-_Faded_(mp3.pm).mp3"},
  { title:"Song Two", src:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"},
  { title:"Song Three", src:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"}
];

let currentTrack = parseInt(localStorage.getItem('musicCurrentTrack')) || 0;
let savedTime = parseFloat(localStorage.getItem('musicTime')) || 0;

/* ===== HELPERS ===== */
function fmt(t){
  const m=Math.floor(t/60);
  const s=Math.floor(t%60).toString().padStart(2,'0');
  return m+":"+s;
}

/* ===== LOAD TRACK ===== */
function loadTrack(index){
  currentTrack=index;
  audio.src=playlist[index].src;
  audio.currentTime=savedTime||0;
  audio.play().catch(()=>{});
  updatePlaylistUI();
  localStorage.setItem('musicCurrentTrack',currentTrack);
}

/* ===== PLAYLIST UI ===== */
function updatePlaylistUI(){
  playlistContainer.innerHTML='';
  playlist.forEach((track,i)=>{
    const div=document.createElement('div');
    div.className='playlistItem'+(i===currentTrack?' active':'');
    div.draggable=true;

    /* NEW: numbering + time */
    div.innerHTML=`
      <span>${i+1}. ${track.title}</span>
      <span class="trackTime">--:--</span>
    `;

    div.onclick=()=>{ savedTime=0; loadTrack(i); };

    /* drag & reorder (UNCHANGED) */
    div.addEventListener('dragstart',e=>{
      div.classList.add('dragging');
      e.dataTransfer.setData('text/plain',i);
    });
    div.addEventListener('dragend',()=>div.classList.remove('dragging'));
    div.addEventListener('dragover',e=>e.preventDefault());
    div.addEventListener('drop',e=>{
      e.preventDefault();
      const from=parseInt(e.dataTransfer.getData('text/plain'));
      const to=Array.from(playlistContainer.children).indexOf(div);
      if(from!==to){
        const item=playlist.splice(from,1)[0];
        playlist.splice(to,0,item);
        currentTrack = to;
        localStorage.setItem('musicPlaylist',JSON.stringify(playlist));
        updatePlaylistUI();
      }
    });

    /* NEW: duration */
    const tspan=div.querySelector('.trackTime');
    const temp=new Audio(track.src);
    temp.onloadedmetadata=()=>{ tspan.textContent=fmt(temp.duration); };

    playlistContainer.appendChild(div);
  });
}

/* ===== EVENTS ===== */
audio.ontimeupdate=()=>{
  const p=(audio.currentTime/(audio.duration||1))*100;
  progressFilled.style.width=p+'%';
  timeDisplay.textContent=fmt(audio.currentTime)+' / '+fmt(audio.duration||0);
  localStorage.setItem('musicTime',audio.currentTime);
};

progressBar.onclick=e=>{
  const r=progressBar.getBoundingClientRect();
  audio.currentTime=((e.clientX-r.left)/r.width)*audio.duration;
};

volumeBar.onclick=e=>{
  const r=volumeBar.getBoundingClientRect();
  audio.volume=(e.clientX-r.left)/r.width;
  volumeFill.style.width=(audio.volume*100)+'%';
  volumeKnob.style.left=(audio.volume*100)+'%';
};

playBtn.onclick=()=>audio.paused?audio.play():audio.pause();
audio.onplay=()=>playBtn.textContent='‚ùö‚ùö';
audio.onpause=()=>playBtn.textContent='‚ñ∂';

prevBtn.onclick=()=>{currentTrack=(currentTrack-1+playlist.length)%playlist.length;loadTrack(currentTrack);};
nextBtn.onclick=()=>{currentTrack=(currentTrack+1)%playlist.length;loadTrack(currentTrack);};

loopBtn.onclick=()=>audio.loop=!audio.loop;

/* ===== INIT ===== */
loadTrack(currentTrack);
</script>

