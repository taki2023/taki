<style>
*{box-sizing:border-box}
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:transparent!important;
  overflow:hidden;
}

/* PLAYER */
#playerBox{
  width:100%;
  padding:10px 12px;
  background:linear-gradient(180deg,rgba(18,12,10,.92),rgba(10,8,7,.95));
  border:2.5px solid rgba(255,176,120,.55);
  border-radius:16px;
  box-shadow:inset 0 0 14px rgba(0,0,0,.55),0 0 14px rgba(255,176,120,.22);
}

/* BARS */
#progressBar,#volumeBar{
  background:linear-gradient(180deg,#1a120f,#120a08);
  border-radius:10px;
  border:1.8px solid rgba(255,176,120,.45);
  box-shadow:inset 0 0 8px rgba(0,0,0,.6),0 0 8px rgba(255,176,120,.15);
  position:relative;
  cursor:pointer;
}

/* FILLS */
#progressFilled{
  height:100%;
  background:linear-gradient(90deg,#ffb37a,#ff8a70);
  border-radius:10px;
}

#volumeFill{
  height:100%;
  background:linear-gradient(90deg,#7b4dff,#9d6bff,#c59bff);
  border-radius:10px;
}

/* KNOBS */
#progressKnob,#volumeKnob{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:14px;
  height:14px;
  border-radius:50%;
  background:#ffd7b0;
}

#volumeKnob{
  background:#e9ddff;
}

/* BUTTON HOVER */
#playPauseBtn:hover, #loopBtn:hover, #cutIcon:hover{
  filter: brightness(1.2);
}

/* TOOLTIP STYLES FIXED + SMALLER */
.tooltip{
  position:fixed;
  background:#fff;
  color:#111;
  padding:2px 6px;
  border-radius:5px;
  font-size:11px;
  font-family:Segoe UI,sans-serif;
  box-shadow:0 2px 4px rgba(0,0,0,.25);
  pointer-events:none;
  opacity:0;
  transition:opacity .15s;
  z-index:9999;
  white-space:nowrap;
}

/* PLAYLIST */
#playlistContainer{
  margin-top:8px;
  max-height:140px;
  overflow-y:auto;
  padding-right:4px;
}
.playlistItem{
  cursor:pointer;
  padding:4px 8px;
  border-radius:6px;
  margin-bottom:2px;
  font-size:12px;
  font-family:Segoe UI,sans-serif;
  color:#f1e7df;
  background:rgba(255,176,120,0.05);
  transition: background .15s;
  user-select:none;
}
.playlistItem:hover{
  background:rgba(255,176,120,0.15);
}
.playlistItem.active{
  background:rgba(255,176,120,0.3);
}
.dragging{
  opacity:0.5;
  background:rgba(255,176,120,0.2);
}
</style>

<div id="playerBox">
  <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;width:100%;">
    <button id="playPauseBtn" style=" width:32px;height:32px;border-radius:50%; background:linear-gradient(145deg,#ffb37a,#ff8a70); border:none;cursor:pointer; ">‚ñ∂</button>
    
    <!-- PROGRESS -->
    <div id="progressBar" style="flex:1;height:8px;">
      <div id="progressFilled" style="width:0%;position:relative;">
        <div id="progressKnob" style="right:-7px;"></div>
      </div>
    </div>

    <!-- TIME -->
    <div id="timeDisplay" style=" min-width:60px; font-size:11px; font-weight:500; font-family:Inter,Segoe UI,system-ui,sans-serif; color:#f1e7df; text-align:right; ">0:00 / 0:00</div>
  </div>

  <!-- VOLUME + LOOP -->
  <div style="display:flex;align-items:center;justify-content:flex-start;gap:6px;margin-bottom:8px;">
    <span id="cutIcon" style="cursor:pointer">üîä</span>
    <div id="volumeBar" style="width:90px;height:5px;">
      <div id="volumeFill"></div>
      <div id="volumeKnob"></div>
    </div>
    <button id="loopBtn" style=" width:30px;height:30px;border-radius:50%; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); cursor:pointer;color:#fff;">üîÅ</button>
  </div>

  <!-- PLAYLIST -->
  <div id="playlistContainer"></div>

  <!-- TOOLTIP -->
  <div id="tooltip" class="tooltip"></div>

  <audio id="audioPlayer"></audio>
</div>

<script>
const audio = document.getElementById('audioPlayer');
const playBtn = document.getElementById('playPauseBtn');
const loopBtn = document.getElementById('loopBtn');
const cutIcon = document.getElementById('cutIcon');
const progressBar = document.getElementById('progressBar');
const progressFilled = document.getElementById('progressFilled');
const volumeBar = document.getElementById('volumeBar');
const volumeFill = document.getElementById('volumeFill');
const volumeKnob = document.getElementById('volumeKnob');
const timeDisplay = document.getElementById('timeDisplay');
const tooltip = document.getElementById('tooltip');
const playlistContainer = document.getElementById('playlistContainer');

/* ===== PLAYLIST ===== */
let playlist = [
  { title: "Faded - Alan Walker", src: "https://cs1.mp3.pm/download/196179361/M0wyQ0lNU3lsSmcrcWVXSFZhSTFtTmZPTm9GL1VtLzMwNXNaZkpWU1FsTGdEcTNxcVFxVjd0dE1uM0dDdkx6Y0lxWk5tRDZqME5uR0NZa1NKeURsdTJZOTB1RVY3bFJlRWJ3UysyMXIvd0pvT21IY2doQ3UycWppcC9hYnc1Uzc/8D_TOP_MUSIC_-_Alan_Walker_-_Faded_(mp3.pm).mp3" },
  { title: "Song Two", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
  { title: "Song Three", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" }
];

let currentTrack = 0;

function loadTrack(index){
  currentTrack = index;
  audio.src = playlist[index].src;
  audio.play().catch(()=>{});
  updatePlaylistUI();
}

function updatePlaylistUI(){
  playlistContainer.innerHTML = '';
  playlist.forEach((track,i)=>{
    const div = document.createElement('div');
    div.textContent = track.title;
    div.className = 'playlistItem' + (i===currentTrack?' active':'');
    div.setAttribute('draggable','true');

    // click to play
    div.onclick = ()=> loadTrack(i);

    // drag events
    div.addEventListener('dragstart', (e)=>{
      div.classList.add('dragging');
      e.dataTransfer.effectAllowed = "move";
      e.dataTransfer.setData("text/plain", i);
    });
    div.addEventListener('dragend', ()=>{
      div.classList.remove('dragging');
      reorderPlaylist();
    });
    div.addEventListener('dragover', (e)=>{
      e.preventDefault();
    });
    div.addEventListener('drop', (e)=>{
      e.preventDefault();
      const fromIndex = parseInt(e.dataTransfer.getData("text/plain"));
      const toIndex = Array.from(playlistContainer.children).indexOf(div);
      if(fromIndex !== toIndex){
        const item = playlist.splice(fromIndex,1)[0];
        playlist.splice(toIndex,0,item);
        if(currentTrack === fromIndex) currentTrack = toIndex;
        else if(fromIndex < currentTrack && toIndex >= currentTrack) currentTrack--;
        else if(fromIndex > currentTrack && toIndex <= currentTrack) currentTrack++;
        updatePlaylistUI();
      }
    });

    playlistContainer.appendChild(div);
  });
}

function reorderPlaylist(){ updatePlaylistUI(); }

/* ===== AUTO PLAY NEXT ===== */
audio.onended = () => {
  let next = currentTrack + 1;
  if(next >= playlist.length) next = 0;
  loadTrack(next);
}

/* ===== INITIAL LOAD ===== */
loadTrack(currentTrack);

/* ===== VOLUME / PLAY / LOOP / TIME / SEEK ===== */
const savedVolume = localStorage.getItem('musicVolume');
const savedMuted = localStorage.getItem('musicMuted') === 'true';
const savedLoop = localStorage.getItem('musicLoop') === 'true';
const savedPlaying = localStorage.getItem('musicPlaying') === 'true';

audio.volume = savedVolume !== null ? parseFloat(savedVolume) : 0.7;
audio.muted = savedMuted;
audio.loop = savedLoop;

function syncVolumeUI(){
  const v = audio.muted ? 0 : audio.volume;
  volumeFill.style.width = (v*100)+'%';
  volumeKnob.style.left = (v*100)+'%';
  cutIcon.textContent = audio.muted || v===0 ? 'üîá' : 'üîä';
}
syncVolumeUI();

playBtn.onclick = ()=> audio.paused ? audio.play() : audio.pause();
audio.onplay = ()=>{ playBtn.textContent='‚ùö‚ùö'; localStorage.setItem('musicPlaying',true); };
audio.onpause = ()=>{ playBtn.textContent='‚ñ∂'; localStorage.setItem('musicPlaying',false); };

loopBtn.onclick = ()=> {
  audio.loop = !audio.loop;
  localStorage.setItem('musicLoop',audio.loop);
  loopBtn.style.background = audio.loop ? 'linear-gradient(145deg,#ffb37a,#ff8a70)' : 'rgba(255,255,255,.08)';
};
loopBtn.style.background = audio.loop ? 'linear-gradient(145deg,#ffb37a,#ff8a70)' : 'rgba(255,255,255,.08)';

function fmt(s){
  const m=Math.floor(s/60);
  const sec=Math.floor(s%60);
  return m+':'+(sec<10?'0':'')+sec;
}
audio.ontimeupdate=()=>{
  const p=(audio.currentTime/(audio.duration||1))*100;
  progressFilled.style.width=p+'%';
  timeDisplay.textContent = fmt(audio.currentTime)+' / '+fmt(audio.duration||0);
};

function seek(e){
  const r=progressBar.getBoundingClientRect();
  const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left;
  if(!audio.duration) return;
  audio.currentTime=Math.max(0,Math.min(1,x/r.width))*audio.duration;
}
progressBar.onmousedown=e=>{ seek(e); document.onmousemove=seek; document.onmouseup=()=>document.onmousemove=null; };
progressBar.ontouchstart=seek; progressBar.ontouchmove=seek;

function setVolume(v){
  v=Math.max(0,Math.min(1,v));
  audio.volume=v;
  audio.muted=false;
  localStorage.setItem('musicVolume',v);
  localStorage.setItem('musicMuted',false);
  syncVolumeUI();
}
function volFromEvent(e){
  const r=volumeBar.getBoundingClientRect();
  const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left;
  setVolume(x/r.width);
}
volumeBar.onmousedown=e=>{ volFromEvent(e); document.onmousemove=volFromEvent; document.onmouseup=()=>document.onmousemove=null; };
volumeBar.ontouchstart=volFromEvent; volumeBar.ontouchmove=volFromEvent;

cutIcon.onclick=()=>{ audio.muted=!audio.muted; localStorage.setItem('musicMuted',audio.muted); syncVolumeUI(); };

/* ===== TOOLTIP ===== */
function showTooltipAtElement(el, text){
  tooltip.textContent = text;
  const rect = el.getBoundingClientRect();
  const tooltipWidth = tooltip.offsetWidth;
  const tooltipHeight = tooltip.offsetHeight;

  let top = rect.top - tooltipHeight - 6;
  let left = rect.left + rect.width/2 - tooltipWidth/2;

  if(top < 4) top = rect.bottom + 6;
  if(left < 4) left = 4;
  if(left + tooltipWidth > window.innerWidth - 4) left = window.innerWidth - tooltipWidth - 4;

  tooltip.style.left = left + 'px';
  tooltip.style.top = top + 'px';
  tooltip.style.opacity = 1;
}
function hideTooltip(){ tooltip.style.opacity = 0; }
function attachTooltip(el, getText){
  el.onmouseenter = ()=> showTooltipAtElement(el,getText());
  el.onmouseleave = hideTooltip;
}
attachTooltip(playBtn, ()=> audio.paused ? 'Play' : 'Pause');
attachTooltip(loopBtn, ()=> 'Loop');
attachTooltip(cutIcon, ()=> audio.muted ? 'Unmute' : 'Mute');
audio.onplay = ()=> { if(tooltip.style.opacity==1) showTooltipAtElement(playBtn,'Pause'); };
audio.onpause = ()=> { if(tooltip.style.opacity==1) showTooltipAtElement(playBtn,'Play'); };
audio.onvolumechange = ()=> { if(tooltip.style.opacity==1) showTooltipAtElement(cutIcon,audio.muted?'Unmute':'Mute'); };
</script>
