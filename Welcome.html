<script>
const club = "hot-chilli-checkmate";
const proxy = "https://api.allorigins.win/raw?url=";

async function loadMember(){
  try {

    const res = await fetch(
      proxy + encodeURIComponent(
        `https://api.chess.com/pub/club/${club}/members/all`
      )
    );

    const data = await res.json();

    if(!data || !data.members || data.members.length === 0){
      document.getElementById("welcomeBox").innerHTML = "No members found.";
      return;
    }

    // Take last member from full list
    const username = data.members[data.members.length - 1].username;

    const playerRes = await fetch(
      proxy + encodeURIComponent(
        `https://api.chess.com/pub/player/${username}`
      )
    );

    const player = await playerRes.json();

    const avatar = player.avatar 
      ? player.avatar 
      : "https://images.chesscomfiles.com/uploads/v1/user/0.1/default_avatar.png";

    document.getElementById("welcomeBox").innerHTML = `
      <img src="${avatar}">
      <div>
        ðŸ‘‹ Welcome <span style="color:#ff8c4a;font-weight:bold;">${username}</span><br>
        to the Chillies Army ðŸ”¥
      </div>
    `;

  } catch(e){
    document.getElementById("welcomeBox").innerHTML = "Could not load member.";
  }
}

loadMember();
setInterval(loadMember, 3000);
</script>
