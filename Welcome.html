<script>
const clubName = "hot-chilli-checkmate";
const proxy = "https://api.allorigins.win/raw?url=";

async function getLatestMember() {
  try {

    const response = await fetch(
      proxy + encodeURIComponent(`https://api.chess.com/pub/club/${clubName}/members`)
    );

    const data = await response.json();

    let username = null;

    if (data.weekly && data.weekly.length > 0) {
      username = data.weekly[data.weekly.length - 1];
    } else if (data.all_time && data.all_time.length > 0) {
      username = data.all_time[data.all_time.length - 1];
    }

    if (!username) {
      document.getElementById("welcomeBox").innerHTML = "No members found.";
      return;
    }

    const playerRes = await fetch(
      proxy + encodeURIComponent(`https://api.chess.com/pub/player/${username}`)
    );

    const playerData = await playerRes.json();

    const avatar = playerData.avatar
      ? playerData.avatar
      : "https://images.chesscomfiles.com/uploads/v1/user/0.1/default_avatar.png";

    document.getElementById("welcomeBox").innerHTML = `
      <img src="${avatar}">
      <div class="text">
        ðŸ‘‹ Welcome <span class="username">${username}</span><br>
        to the Chillies Army ðŸ”¥
      </div>
    `;

  } catch (err) {
    document.getElementById("welcomeBox").innerHTML = "Could not load member.";
  }
}

getLatestMember();
setInterval(getLatestMember, 300000);
</script>

