

<div id="welcomeBox">Loading...</div>

<script>
const club = "hot-chilli-checkmate";
const proxy = "https://corsproxy.io/?";
const storageKey = "clubMembers";

async function fetchMembers() {
  const res = await fetch(
    proxy + encodeURIComponent(`https://api.chess.com/pub/club/${club}/members`)
  );
  const data = await res.json();
  
  // Use the all_time array and sort by 'joined' descending
  const sorted = data.all_time.sort((a, b) => b.joined - a.joined);
  return sorted; // return full sorted array
}

async function checkForNewMember() {
  try {
    const currentList = await fetchMembers();

    const savedData = JSON.parse(localStorage.getItem(storageKey));

    // First time loading â†’ just store
    if (!savedData) {
      localStorage.setItem(storageKey, JSON.stringify(currentList));
      document.getElementById("welcomeBox").innerHTML = "Tracking new members...";
      return;
    }

    // Compare and find the newest member
    const savedUsernames = savedData.map(member => member.username);
    const newest = currentList.find(member => !savedUsernames.includes(member.username));

    if (newest) {
      document.getElementById("welcomeBox").innerHTML =
        `ðŸŽ‰ NEW RECRUIT!<br><b>${newest.username}</b> joined the Chillies Army ðŸ”¥`;

      // Update stored data
      localStorage.setItem(storageKey, JSON.stringify(currentList));
    } else {
      document.getElementById("welcomeBox").innerHTML = "No new members yet.";
    }

  } catch (e) {
    console.error(e);
    document.getElementById("welcomeBox").innerHTML = "Error checking members.";
  }
}

// Run immediately
checkForNewMember();

// Check every 2 minutes
setInterval(checkForNewMember, 120000);
</script>

