<div id="welcomeBox" style="font-size:18px;font-weight:bold;color:#fff;text-align:center;padding:10px;background:#222;border-radius:10px;">
  Loading newest member...
</div>

<script>
const club = "hot-chilli-checkmate";
const proxy = "https://corsproxy.io/?"; // Avoid CORS issues
const storageKey = "clubMembers";

// Fetch all members with timestamps
async function fetchMembers() {
  const res = await fetch(
    proxy + encodeURIComponent(`https://api.chess.com/pub/club/${club}/members`)
  );
  const data = await res.json();
  return data.all_time; // Array of {username, joined}
}

async function checkForNewMember() {
  try {
    const currentList = await fetchMembers();

    // Find the newest member by joined timestamp
    const newestObj = currentList.reduce((a, b) => a.joined > b.joined ? a : b);
    const newest = newestObj.username;

    // Load previous newest member from localStorage
    const savedNewest = localStorage.getItem(storageKey);

    if (!savedNewest) {
      // First run â†’ just store
      localStorage.setItem(storageKey, newest);
      document.getElementById("welcomeBox").innerHTML = "Tracking new members...";
      return;
    }

    if (savedNewest !== newest) {
      // New member detected!
      document.getElementById("welcomeBox").innerHTML =
        `ðŸŽ‰ NEW RECRUIT!<br><b>${newest}</b> joined the Chillies Army ðŸ”¥`;

      // Update localStorage
      localStorage.setItem(storageKey, newest);
    } else {
      document.getElementById("welcomeBox").innerHTML =
        "No new members yet.";
    }

  } catch (e) {
    console.log(e);
    document.getElementById("welcomeBox").innerHTML =
      "Error checking members.";
  }
}

// Run immediately
checkForNewMember();

// Check every 10 seconds
setInterval(checkForNewMember, 10000);
</script>
