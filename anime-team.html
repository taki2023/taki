<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
*{box-sizing:border-box;}

html,body{
  margin:0;
  padding:0;
  background:transparent !important;
  font-family: Arial, Helvetica, sans-serif;
  color:#eaeaea;
}

/* REMOVE OUTER PANEL LOOK */
#membersBox{
  width:100%;
}

/* LIST */
#membersList{
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* MEMBER ROW */
.memberRow{
  background:#1a2233;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.15);
  transition:.25s ease;
}

.memberRow:hover{
  transform:translateY(-4px);
  background:#d6b26a;
  box-shadow:0 8px 20px rgba(0,0,0,.6);
}

/* LINK */
.memberLink{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  text-decoration:none;
  color:#eaeaea;
}

.memberRow:hover .memberLink{
  color:#000;
}

/* AVATAR */
.memberAvatar{
  width:46px;
  height:46px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid #d6b26a;
}

/* TEXT */
.memberText{
  display:flex;
  flex-direction:column;
  min-width:0;
}

.memberName{
  font-size:14px;
  font-weight:800;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.memberRating{
  font-size:12px;
  opacity:.9;
}
</style>
</head>

<body>

<div id="membersBox">
  <div id="membersList"></div>
</div>

<script>
async function loadNewest() {
  try {
    const r = await fetch("https://api.chess.com/pub/club/anime-team-3/members");
    const d = await r.json();
    const members = [...d.weekly, ...d.monthly];
    members.sort((a,b)=>b.joined-a.joined);
    const top3 = members.slice(0,3);

    const promises = top3.map(async (m)=>{
      const [pj, stats] = await Promise.all([
        fetch("https://api.chess.com/pub/player/"+m.username).then(r=>r.json()),
        fetch("https://api.chess.com/pub/player/"+m.username+"/stats").then(r=>r.json())
      ]);

      const ratings=[
        {t:"Rapid",v:stats.chess_rapid?.last?.rating},
        {t:"Blitz",v:stats.chess_blitz?.last?.rating},
        {t:"Bullet",v:stats.chess_bullet?.last?.rating},
        {t:"Daily",v:stats.chess_daily?.last?.rating}
      ].filter(x=>x.v);

      const best = ratings.length
        ? ratings.sort((a,b)=>b.v-a.v)[0]
        : {t:"—",v:"—"};

      return {
        username:m.username,
        avatar: pj.avatar || "https://taki2023.github.io/taki/default-pawn.png",
        rt:best.t,
        rv:best.v
      };
    });

    const data = await Promise.all(promises);

    const box = document.getElementById("membersList");
    box.innerHTML = data.map(m=>`
      <div class="memberRow">
        <a class="memberLink" href="https://www.chess.com/member/${m.username}" target="_blank">
          <img class="memberAvatar" src="${m.avatar}">
          <div class="memberText">
            <div class="memberName">@${m.username}</div>
            <div class="memberRating">${m.rt}: ${m.rv}</div>
          </div>
        </a>
      </div>
    `).join("");

  } catch(e){
    document.getElementById("membersList").innerHTML="Unable to load members";
  }
}

window.addEventListener("DOMContentLoaded", loadNewest);
</script>

</body>
</html>
